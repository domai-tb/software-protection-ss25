# Sample: `mba_malware`

## a)

The sample is a Windows DLL file because it contains characteristic DLL function that start with the `dllmain_` prefix. It provides multiple obfuscated functions that cannot identified easily and all named as sub-roitines in BinaryNinja with the prefix `sub_`, with one exception - `snagit` (address `0x1800873d0`). The reason for that is, that this function is exported by the DLL and is therefore used by the main (malware) executable. 

Within the `snagit` function, control flow and functionality is hidden by using long MBAs on registers which are evaluated and acted upon in jumps. The function also calls the other sub-routines that are also obfuscated with MBAs.

Note: I used this [EXE/DLL PE Viewer and Editor](https://speedtesting.herokuapp.com/peviewer/) to extract the [DLL exports](./mba_malware_dll_exports.csv).

## b) 

We can apply the same method used in the previous task sheet to deobfuscate the opaque predicates as well as the MBAs. Using Miasm, we symbolically execute all basic blocks and inspect those that end with a conditional jump. For each of these, we extract the associated condition expression. To determine whether the jump is always or never taken, we use different analysis techniques. One approach involves using Z3 to check if the constraint—where the condition equals the jump target—is unsatisfiable. If Z3 determines the constraint is unsatisfiable, we can conclude that the jump target is never taken.